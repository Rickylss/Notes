# spin自旋锁

> 轮询忙等待

​	在单核cpu下不起作用：被自旋锁保护的临界区代码执行时不能进行挂起状态。会造成死锁 。

​	自旋锁的初衷就是：在短期间内进行轻量级的锁定。一个被争用的自旋锁使得请求它的线程在等待锁重新可用的期间进行自旋（特别浪费处理器时间），所以自旋锁不应该被持有时间过长。如果需要长时间锁定的话, 最好使用信号量。

```c
#include <pthread.h>
pthread_spin_lock
```

## 分析

​	Mutex属于sleep-waiting类型的锁。假设线程A和线程B，分别运行在Core0和Core1上，A想通过Pthread_mutex_lock获得一个临界区的锁，而该锁被B持有，则A被阻塞，Core0会进行上下文切换将A置于等待队列中，此时Core0运行其他线程而不必忙等待。这点与spinlock不同，若A使用pthread_spin_lock，则A一直在Core0上进行锁请求，直到获取该锁。